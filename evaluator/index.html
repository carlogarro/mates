<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Participaci√≥n en clase</title>
    <script type="module">
      // Importar Firebase desde la CDN
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        setDoc,
        doc,
        updateDoc,
      } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

      // üëâ Pega aqu√≠ tu configuraci√≥n de Firebase
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyBICN6ie-yV2dL3pQeKnR_qFFQ-LsAkuVs",
        authDomain: "evaluacion-continua-39a84.firebaseapp.com",
        projectId: "evaluacion-continua-39a84",
        storageBucket: "evaluacion-continua-39a84.firebasestorage.app",
        messagingSenderId: "1073788724297",
        appId: "1:1073788724297:web:ecd14963702acdc0054b98",
        measurementId: "G-1QSK510FL1",
      };

      // Inicializar Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      let alumnos = [];
      let alumnoActual = null;

      // Cargar lista de Firestore
      async function cargarAlumnos() {
        alumnos = [];
        const querySnapshot = await getDocs(collection(db, "alumnos"));
        querySnapshot.forEach((docSnap) => {
          alumnos.push({ id: docSnap.id, ...docSnap.data() });
        });
        mostrarTabla();
      }

      async function guardarAlumno(nombre) {
        await setDoc(doc(db, "alumnos", nombre), { bien: 0, mal: 0 });
        cargarAlumnos();
      }

      async function registrar(resultado) {
        if (!alumnoActual) return alert("Primero elige un alumno");
        const ref = doc(db, "alumnos", alumnoActual.id);
        let nuevoValor = alumnoActual[resultado] + 1;
        await updateDoc(ref, { [resultado]: nuevoValor });
        cargarAlumnos();
        document.getElementById("alumno").textContent = "---";
        alumnoActual = null;
      }

      function elegirAlumno() {
        if (alumnos.length === 0) return alert("No hay alumnos");
        const idx = Math.floor(Math.random() * alumnos.length);
        alumnoActual = alumnos[idx];
        document.getElementById("alumno").textContent = alumnoActual.nombre;
      }

      function mostrarTabla() {
        const cuerpo = document.getElementById("cuerpoTabla");
        cuerpo.innerHTML = "";
        alumnos.forEach((a) => {
          let fila = `<tr>
          <td>${a.nombre}</td>
          <td>${a.bien}</td>
          <td>${a.mal}</td>
        </tr>`;
          cuerpo.innerHTML += fila;
        });
      }

      // Exponer funciones globalmente
      window.guardarAlumno = guardarAlumno;
      window.elegirAlumno = elegirAlumno;
      window.registrar = registrar;
      window.cargarAlumnos = cargarAlumnos;

      // Cargar al iniciar
      window.onload = cargarAlumnos;
    </script>
  </head>
  <body>
    <h1>Participaci√≥n en clase (Firebase)</h1>
    <input id="nuevoAlumno" placeholder="Nombre alumno" />
    <button
      onclick="guardarAlumno(document.getElementById('nuevoAlumno').value)"
    >
      A√±adir alumno
    </button>

    <div id="alumno">---</div>
    <button onclick="elegirAlumno()">üé≤ Elegir alumno</button>
    <button onclick="registrar('bien')">‚úÖ Bien</button>
    <button onclick="registrar('mal')">‚ùå Mal</button>

    <table border="1">
      <thead>
        <tr>
          <th>Alumno</th>
          <th>Bien</th>
          <th>Mal</th>
        </tr>
      </thead>
      <tbody id="cuerpoTabla"></tbody>
    </table>
  </body>
</html>
